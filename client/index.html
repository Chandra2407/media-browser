<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Node.js Media Server</title>
    <style>
        body {
            font-family: Arial;
            background: #111;
            color: #eee;
            padding: 20px;
            max-width: 800px;
            margin: auto;
        }

        button,
        input {
            margin: 5px;
            padding: 8px;
            font-size: 14px;
        }

        .tabs {
            display: flex;
            margin-top: 20px;
            border-bottom: 2px solid #444;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background: #222;
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
        }

        .tab.active {
            background: #555;
            font-weight: bold;
        }

        .file-list {
            margin-top: 10px;
        }

        .file-item {
            padding: 5px;
            border-bottom: 1px solid #333;
            cursor: pointer;
        }

        video,
        audio {
            width: 100%;
            margin-top: 10px;
            border: 1px solid #444;
            border-radius: 5px;
        }
    </style>
</head>

<body>

    <h1>ðŸŽ¬ Node.js Media Server</h1>
    <input type="file" id="fileInput"><button onclick="uploadFile()">Upload</button>
    <p id="progress">Progress: 0%</p>

    <div class="tabs">
        <div class="tab active" onclick="showTab('video')">Video</div>
        <div class="tab" onclick="showTab('audio')">Audio</div>
    </div>

    <div id="videoList" class="file-list"></div>
    <div id="audioList" class="file-list" style="display:none;"></div>

    <video id="videoPlayer" controls></video>
    <audio id="audioPlayer" controls></audio>

    <script>
        let currentTab = 'video';
        let files = { video: [], audio: [] };

        function showTab(tab) {
            currentTab = tab;
            document.getElementById('videoList').style.display = tab === 'video' ? 'block' : 'none';
            document.getElementById('audioList').style.display = tab === 'audio' ? 'block' : 'none';
            document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
            document.querySelector(`.tab[onclick="showTab('${tab}')"]`).classList.add('active');
        }

        function renderFiles() {
            const videoContainer = document.getElementById('videoList');
            const audioContainer = document.getElementById('audioList');
            videoContainer.innerHTML = ''; audioContainer.innerHTML = '';
            files.video.forEach(f => { const div = document.createElement('div'); div.className = 'file-item'; div.textContent = f; div.onclick = () => playFile(f, 'video'); videoContainer.appendChild(div); });
            files.audio.forEach(f => { const div = document.createElement('div'); div.className = 'file-item'; div.textContent = f; div.onclick = () => playFile(f, 'audio'); audioContainer.appendChild(div); });
        }

        function playFile(filename, type) {
            if (type === 'video') { document.getElementById('videoPlayer').src = `http://localhost:3000/video?file=${filename}`; document.getElementById('videoPlayer').play(); }
            else { document.getElementById('audioPlayer').src = `http://localhost:3000/video?file=${filename}`; document.getElementById('audioPlayer').play(); }
        }

        async function loadFiles() {
            const res = await fetch('http://localhost:3000/files');
            const data = await res.json();
            files.video = data.video; files.audio = data.audio;
            renderFiles();
        }

        function uploadFile() {
            const input = document.getElementById('fileInput');
            if (!input.files[0]) return;
            const file = input.files[0];
            const xhr = new XMLHttpRequest();
            xhr.upload.onprogress = e => { document.getElementById('progress').textContent = `Progress: ${Math.round(e.loaded / e.total * 100)}%`; }
            xhr.open('POST', 'http://localhost:3000/upload', true);
            xhr.setRequestHeader('file-name', file.name);
            xhr.send(file);
        }

        const evtSource = new EventSource('http://localhost:3000/events');
        evtSource.onmessage = function (e) {
            const [type, name] = e.data.split(':');
            files[type].push(name);
            renderFiles();
        }

        window.onload = loadFiles;
    </script>

</body>

</html>